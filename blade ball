-- blade_ball_script.lua

-- Загружаем библиотеку MacLib
local MacLib = loadstring(game:HttpGet("https://github.com/biggaboy212/Maclib/releases/latest/download/maclib.txt"))()

-- Создаем главное окно с увеличенным размером
local Window = MacLib:Window({
    Title = "Blade Ball",
    Subtitle = "Free V1",
    Size = UDim2.fromOffset(800, 550), -- Увеличили размер окна
    DragStyle = 1,
    DisabledWindowControls = {},
    ShowUserInfo = true,
    Keybind = Enum.KeyCode.RightControl,
    AcrylicBlur = true,
})

-- Создаем группу вкладок
local TabGroup = Window:TabGroup()

-- Создаем вкладки
local CombatTab = TabGroup:Tab({
    Name = "Combat",
    Image = "rbxassetid://6034818372"
})

local VisualsTab = TabGroup:Tab({
    Name = "Visuals", 
    Image = "rbxassetid://6034818398"
})

local SettingsTab = TabGroup:Tab({
    Name = "Settings",
    Image = "rbxassetid://6034818378"
})

-- Создаем секции для вкладки Combat
local CombatSection = CombatTab:Section({
    Side = "Left"
})

-- Добавляем элементы в секцию Combat
local AutoParry = false
local AutoParryToggle = CombatSection:Toggle({
    Name = "Auto Parry",
    Default = false,
    Callback = function(Value)
        AutoParry = Value
        if Value then
            Window:Notify({
                Title = "Auto Parry",
                Description = "Авто-блокировка включена",
                Style = "Confirm"
            })
        else
            Window:Notify({
                Title = "Auto Parry", 
                Description = "Авто-блокировка выключена",
                Style = "Cancel"
            })
        end
    end
})

local PredictionEnabled = false
local PredictionToggle = CombatSection:Toggle({
    Name = "Ball Prediction",
    Default = false,
    Callback = function(Value)
        PredictionEnabled = Value
        if Value then
            Window:Notify({
                Title = "Ball Prediction",
                Description = "Предсказание траектории включено",
                Style = "Confirm"
            })
        else
            Window:Notify({
                Title = "Ball Prediction", 
                Description = "Предсказание траектории выключено",
                Style = "Cancel"
            })
        end
    end
})

-- Слайдер для настройки силы предсказания
local PredictionStrength = 50
local PredictionSlider = CombatSection:Slider({
    Name = "Prediction Strength",
    Default = 50,
    Minimum = 0,
    Maximum = 100,
    Precision = 0,
    Callback = function(Value)
        PredictionStrength = Value
    end
})

-- Улучшаем внешний вид слайдера
task.spawn(function()
    wait(0.5) -- Даем время для инициализации
    if PredictionSlider then
        -- Увеличиваем ширину слайдера через изменение его свойств
        PredictionSlider:SetStyle({
            Size = UDim2.new(0.9, 0, 0, 30) -- Ширина 90% от родителя, высота 30px
        })
    end
end)

-- Создаем секции для вкладки Visuals
local VisualsSection = VisualsTab:Section({
    Side = "Left"
})

local BallESPToggle = VisualsSection:Toggle({
    Name = "Ball ESP",
    Default = false,
    Callback = function(Value)
        if Value then
            Window:Notify({
                Title = "Ball ESP",
                Description = "ESP мяча включено",
                Style = "Confirm"
            })
        else
            Window:Notify({
                Title = "Ball ESP", 
                Description = "ESP мяча выключено",
                Style = "Cancel"
            })
        end
    end
})

local PlayerESPToggle = VisualsSection:Toggle({
    Name = "Player ESP",
    Default = false,
    Callback = function(Value)
        if Value then
            Window:Notify({
                Title = "Player ESP",
                Description = "ESP игроков включено",
                Style = "Confirm"
            })
        else
            Window:Notify({
                Title = "Player ESP", 
                Description = "ESP игроков выключено",
                Style = "Cancel"
            })
        end
    end
})

-- Создаем секции для вкладки Settings
local SettingsSection = SettingsTab:Section({
    Side = "Left"
})

local KeybindButton = SettingsSection:Keybind({
    Name = "Toggle UI Keybind",
    Default = Enum.KeyCode.RightShift,
    Callback = function(Key)
        Window:SetKeybind(Key)
    end
})

local DestroyButton = SettingsSection:Button({
    Name = "Destroy UI",
    Callback = function()
        Window:Destroy()
    end
})

local RejoinButton = SettingsSection:Button({
    Name = "Rejoin Server",
    Callback = function()
        game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, game.JobId)
    end
})

-- Функция для поиска мяча
local function findBall()
    for _, obj in pairs(workspace:GetChildren()) do
        if obj.Name:find("Ball") or obj.Name:find("Sphere") then
            return obj
        end
    end
    return nil
end

-- Функция для предсказания движения мяча
local function predictBallMovement(ball, strength)
    if not ball or not ball:FindFirstChild("Velocity") then
        return nil
    end
    
    -- Простое предсказание на основе текущей скорости
    -- Сила предсказания (strength) влияет на "агрессивность" предсказания
    local predictionFactor = strength / 100 -- Преобразуем 0-100 в 0.0-1.0
    
    -- Возвращаем предсказанную позицию
    if ball.Velocity.Magnitude > 0 then
        local direction = ball.Velocity.Unit
        local speed = ball.Velocity.Magnitude
        local prediction = ball.Position + (direction * speed * predictionFactor * 0.5)
        return prediction
    end
    
    return ball.Position
end

-- Основной цикл для авто-блокировки
task.spawn(function()
    while task.wait(0.1) do
        if AutoParry then
            pcall(function()
                local ball = findBall()
                local character = game.Players.LocalPlayer.Character
                
                if ball and character and character:FindFirstChild("HumanoidRootPart") then
                    -- Используем предсказание, если включено
                    local targetPosition = ball.Position
                    if PredictionEnabled then
                        targetPosition = predictBallMovement(ball, PredictionStrength) or ball.Position
                    end
                    
                    local distance = (targetPosition - character.HumanoidRootPart.Position).Magnitude
                    
                    if distance < 25 then -- Настройка дистанции срабатывания
                        -- Код для блокировки
                        keypress(0x45) -- E key
                        task.wait(0.2) -- Фиксированное время блокировки
                        keyrelease(0x45)
                    end
                end
            end)
        end
    end
end)

Window:Notify({
    Title = "Blade Ball Utilities",
    Description = "Меню загружено успешно!",
    Style = "Confirm"
})
